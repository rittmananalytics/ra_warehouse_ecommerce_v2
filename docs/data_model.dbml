// Ra Ecommerce Data Warehouse v2 - Data Model
// Generated from actual BigQuery schemas in analytics_ecommerce datasets

Project ra_ecommerce_dw {
  database_type: 'BigQuery'
  Note: 'Ra Ecommerce Data Warehouse v2 - Multi-source ecommerce analytics platform with actual BigQuery table schemas'
}

//==============================================================================
// STAGING LAYER - Data cleaning and standardization
// Dataset: analytics_ecommerce_staging
//==============================================================================

TableGroup staging_shopify {
  stg_shopify_ecommerce__customers
  stg_shopify_ecommerce__orders  
  stg_shopify_ecommerce__order_lines
  stg_shopify_ecommerce__products
  stg_shopify_ecommerce__transactions
  stg_shopify_ecommerce__discounts
  stg_shopify_ecommerce__inventory_levels
  stg_shopify_ecommerce__customer_cohorts
  stg_shopify_ecommerce__daily_shop
}

Table stg_shopify_ecommerce__customers {
  customer_id integer [pk, not null, note: 'Unique identifier for customer from Shopify']
  customer_email string [not null, note: 'Customer email address']
  customer_first_name string [note: 'Customer first name']
  customer_last_name string [note: 'Customer last name']
  customer_phone string [note: 'Customer phone number']
  customer_created_at timestamp [not null, note: 'Timestamp when customer was created in Shopify']
  customer_accepts_marketing boolean [note: 'Boolean indicating if customer accepts marketing']
  customer_state string [note: 'Customer account state (enabled, disabled, etc.)']
  customer_tags string [note: 'Tags associated with customer']
  orders_count integer [not null, note: 'Number of orders placed by customer']
  total_spent decimal [not null, note: 'Total amount spent by customer']
  
  Note: 'Cleaned and standardized customer data from Shopify with calculated metrics and segments'
}

Table stg_shopify_ecommerce__orders {
  order_id integer [pk, not null, note: 'Unique identifier for order from Shopify']
  order_name string [not null, note: 'Human-readable order name/number']
  customer_id integer [ref: > stg_shopify_ecommerce__customers.customer_id, not null, note: 'Foreign key to customer who placed order']
  customer_email string [note: 'Customer email address']
  order_created_at timestamp [not null, note: 'Timestamp when order was created']
  order_updated_at timestamp [note: 'Timestamp when order was last updated']
  processed_at timestamp [note: 'Timestamp when order was processed']
  financial_status string [not null, note: 'Financial status of order (paid, pending, etc.)']
  fulfillment_status string [note: 'Fulfillment status of order']
  order_total_price float [not null, note: 'Total price of order including taxes and shipping']
  order_subtotal_price float [note: 'Subtotal price before taxes and shipping']
  order_total_tax float [note: 'Total tax amount']
  order_total_discount float [note: 'Total discount amount']
  total_line_items_price float [note: 'Total price of all line items']
  shipping_cost float [note: 'Shipping cost']
  order_adjustment_amount float [note: 'Order adjustment amount']
  order_total_weight numeric [note: 'Total weight of order']
  currency_code string [not null, note: 'Currency code for order']
  order_tags string [note: 'Tags associated with order']
  cancelled_at timestamp [note: 'Timestamp when order was cancelled']
  cancel_reason string [note: 'Reason for cancellation']
  refund_amount numeric [note: 'Total refund amount']
  customer_order_sequence_number integer [note: 'Order sequence number for customer']
  new_vs_repeat string [note: 'New vs repeat customer indicator']
  order_line_count integer [note: 'Number of line items in order']
  source_name string [note: 'Order source']
  referring_site string [note: 'Referring website']
  landing_site_base_url string [note: 'Landing page base URL']
  utm_source string [note: 'UTM source parameter']
  utm_medium string [note: 'UTM medium parameter']
  utm_campaign string [note: 'UTM campaign parameter']
  
  Note: 'Cleaned and standardized order data from Shopify with calculated metrics and attribution data'
}

Table stg_shopify_ecommerce__order_lines {
  order_line_id bigint [pk, not null, note: 'Unique identifier for order line item']
  order_id bigint [ref: > stg_shopify_ecommerce__orders.order_id, not null, note: 'Foreign key to order']
  product_id bigint [ref: > stg_shopify_ecommerce__products.product_id, not null, note: 'Foreign key to product']
  variant_id bigint [note: 'Product variant identifier']
  quantity integer [not null, note: 'Quantity of product ordered']
  price decimal [not null, note: 'Unit price of product']
  total_discount decimal [note: 'Total discount applied to line item']
  line_item_total decimal [not null, note: 'Total amount for line item (price * quantity - discounts)']
  
  Note: 'Cleaned order line items from Shopify with product details'
}

Table stg_shopify_ecommerce__products {
  product_id bigint [pk, not null, note: 'Unique identifier for product from Shopify']
  product_title string [not null, note: 'Product title']
  product_handle string [note: 'URL handle for product']
  product_type string [note: 'Product type/category']
  vendor string [note: 'Product vendor']
  product_created_at timestamp [not null, note: 'Timestamp when product was created']
  product_updated_at timestamp [note: 'Timestamp when product was last updated']
  product_status string [not null, note: 'Product status (active, draft, archived)']
  tags string [note: 'Product tags']
  
  Note: 'Cleaned and standardized product data from Shopify'
}

TableGroup staging_ga4 {
  stg_ga4_events__page_view
  stg_ga4_events__purchase
  stg_ga4_events__add_to_cart
  stg_ga4_events__add_to_cart_items
  stg_ga4_events__add_payment_info
  stg_ga4_events__add_shipping_info
  stg_ga4_events__begin_checkout
  stg_ga4_events__session_start
  stg_ga4_events__view_item
}

Table stg_ga4_events__page_view {
  event_key string [pk, not null, note: 'Unique key for event record']
  event_date date [not null, note: 'Date of the event']
  event_timestamp timestamp [not null, note: 'Timestamp of the event']
  user_pseudo_id string [not null, note: 'User pseudo ID from GA4']
  session_id string [not null, note: 'Session identifier']
  page_title string [note: 'Title of the page viewed']
  page_location string [note: 'URL of the page viewed']
  page_referrer string [note: 'Referrer URL']
  traffic_source_source string [note: 'Traffic source']
  traffic_source_medium string [note: 'Traffic medium']
  traffic_source_campaign string [note: 'Campaign name']
  device_category string [note: 'Device category (desktop, mobile, tablet)']
  geo_country string [note: 'Country of user']
  geo_region string [note: 'Region of user']
  geo_city string [note: 'City of user']
  
  Note: 'Page view events from Google Analytics 4 with cleaned and standardized fields'
}

Table stg_ga4_events__purchase {
  event_key string [pk, not null, note: 'Unique key for event record']
  event_date date [not null, note: 'Date of the purchase event']
  event_timestamp timestamp [not null, note: 'Timestamp of the purchase event']
  user_pseudo_id string [not null, note: 'User pseudo ID from GA4']
  session_id string [not null, note: 'Session identifier']
  transaction_id string [note: 'Transaction/order identifier']
  value decimal [not null, note: 'Purchase value']
  currency string [not null, note: 'Currency code']
  tax decimal [note: 'Tax amount']
  shipping decimal [note: 'Shipping amount']
  coupon string [note: 'Coupon code used']
  
  Note: 'Purchase events from Google Analytics 4 with ecommerce data'
}

//==============================================================================
// INTEGRATION LAYER - Business logic and cross-source joins
// Dataset: analytics_ecommerce_integration
//==============================================================================

TableGroup integration_core {
  int_customers
  int_orders
  int_products
  int_sessions
  int_events
  int_ga4_sessions
  int_channels_enhanced
  int_channels_working
  int_categories_simple
  int_inventory_simple
  int_customer_metrics_simple
}

Table int_customers {
  customer_id bigint [pk, not null, note: 'Unique identifier for customers from Shopify']
  customer_email string [not null, note: 'Customer email address']
  customer_first_name string [note: 'Customer first name']
  customer_last_name string [note: 'Customer last name']
  customer_full_name string [note: 'Concatenated full name']
  customer_created_at timestamp [not null, note: 'Timestamp when customer was created']
  calculated_lifetime_value decimal [not null, note: 'Calculated customer lifetime value based on actual orders']
  calculated_order_count integer [not null, note: 'Count of orders for this customer']
  calculated_avg_order_value decimal [note: 'Average order value for this customer']
  days_since_first_order integer [note: 'Days since customer first order']
  days_since_last_order integer [note: 'Days since customer last order']
  customer_segment string [note: 'Customer segmentation based on order behavior and value']
  customer_value_tier string [note: 'Value tier based on lifetime spend']
  is_active_customer boolean [note: 'Boolean indicating if customer is currently active']
  
  Note: 'Integration layer for customer data with calculated metrics, segmentation, and business rules applied'
}

Table int_orders {
  order_id bigint [pk, not null, note: 'Unique identifier for orders from Shopify']
  customer_id bigint [ref: > int_customers.customer_id, not null, note: 'Customer who placed the order']
  order_number string [not null, note: 'Human-readable order number']
  order_date date [not null, note: 'Date when order was placed']
  order_created_at timestamp [not null, note: 'Timestamp when order was created']
  financial_status string [note: 'Financial status of order']
  fulfillment_status string [note: 'Fulfillment status of order']
  order_total_price decimal [not null, note: 'Total price of the order including taxes and shipping']
  order_subtotal_price decimal [note: 'Subtotal before taxes and shipping']
  order_tax_amount decimal [note: 'Total tax amount']
  order_discount_amount decimal [note: 'Total discount amount']
  order_shipping_cost decimal [note: 'Shipping cost']
  line_item_count integer [not null, note: 'Number of line items in the order']
  total_quantity integer [not null, note: 'Total quantity of items ordered']
  unique_products_count integer [not null, note: 'Number of unique products in order']
  order_type string [note: 'Classification of order type based on characteristics']
  is_first_order boolean [note: 'Boolean indicating if this is customer first order']
  order_sequence_number integer [not null, note: 'Sequential order number for this customer']
  
  Note: 'Integration layer for order data with line item aggregations, business metrics, and enhanced attributes'
}

Table int_products {
  product_id bigint [pk, not null, note: 'Unique identifier for products from Shopify']
  product_title string [not null, note: 'Product title']
  product_handle string [note: 'URL handle for product']
  product_type string [note: 'Product type/category']
  vendor string [note: 'Product vendor']
  product_status string [note: 'Current product status']
  total_revenue decimal [not null, note: 'Total revenue generated by this product']
  total_orders integer [not null, note: 'Total number of orders containing this product']
  total_quantity_sold integer [not null, note: 'Total quantity sold']
  avg_order_value decimal [note: 'Average order value for orders containing this product']
  product_performance_category string [note: 'Performance categorization based on sales volume and revenue']
  revenue_tier string [note: 'Revenue tier based on total revenue generated']
  days_since_last_sale integer [note: 'Days since product was last sold']
  is_active_seller boolean [note: 'Boolean indicating if product has sold recently']
  
  Note: 'Integration layer for product data with performance metrics, inventory status, and business classifications'
}

TableGroup integration_marketing {
  int_campaigns
  int_customer_journey
  int_email_events
  int_email_campaign_performance
  int_klaviyo_email_events
  int_klaviyo_campaign_performance
  int_data_pipeline_metadata
}

Table int_campaigns {
  campaign_key string [pk, not null, note: 'Unique surrogate key for campaign across platforms']
  campaign_id string [not null, note: 'Campaign identifier from source platform']
  platform string [not null, note: 'Advertising platform (google_ads, facebook_ads, pinterest_ads)']
  campaign_name string [not null, note: 'Campaign name']
  status string [not null, note: 'Campaign status']
  start_date date [note: 'Campaign start date']
  end_date date [note: 'Campaign end date']
  budget_amount decimal [note: 'Campaign budget amount']
  cost_usd decimal [not null, note: 'Total cost in USD']
  impressions integer [not null, note: 'Total impressions']
  clicks integer [not null, note: 'Total clicks']
  conversions decimal [not null, note: 'Total conversions']
  conversion_value decimal [note: 'Total conversion value']
  ctr decimal [note: 'Click-through rate']
  cpc_usd decimal [note: 'Cost per click in USD']
  conversion_rate decimal [note: 'Conversion rate (conversions/clicks)']
  value_per_conversion decimal [note: 'Average value per conversion']
  ctr_performance string [note: 'CTR performance tier']
  conversion_performance string [note: 'Conversion performance tier']
  campaign_type string [note: 'Categorized campaign type based on name']
  efficiency_score decimal [note: 'Overall efficiency score (0-100)']
  
  Note: 'Integration layer for advertising campaigns from multiple platforms with unified metrics and performance indicators'
}

Table int_customer_journey {
  journey_key string [pk, not null, note: 'Unique identifier for journey record']
  shopify_customer_id bigint [ref: > int_customers.customer_id, not null, note: 'Ecommerce customer ID for the conversion']
  shopify_order_id bigint [ref: > int_orders.order_id, not null, note: 'Ecommerce order ID for the conversion']
  session_id string [not null, note: 'Website session ID']
  converting_user_pseudo_id string [not null, note: 'User pseudo ID for the converting user']
  order_date date [not null, note: 'Date of the order']
  session_date date [not null, note: 'Date of the session']
  days_from_session_to_order integer [not null, note: 'Number of days between session and order']
  order_value decimal [not null, note: 'Value of the order']
  session_duration_minutes decimal [note: 'Duration of the session in minutes']
  session_page_views integer [note: 'Number of page views in the session']
  traffic_source string [note: 'Traffic source for the session']
  traffic_medium string [note: 'Traffic medium for the session']
  device_category string [note: 'Device category used']
  journey_complexity string [note: 'Classification of customer journey complexity based on touchpoints']
  conversion_timeline string [note: 'Timeline from first touch to conversion']
  is_converting_session boolean [note: 'Boolean indicating if this session resulted in conversion']
  attribution_weight decimal [not null, note: 'Calculated attribution weight for this touchpoint']
  normalized_attribution_weight decimal [not null, note: 'Normalized attribution weight (sums to 1.0 per order)']
  
  Note: 'Integration layer linking website sessions to ecommerce conversions for comprehensive customer journey analysis'
}

//==============================================================================
// WAREHOUSE LAYER - Dimensional model optimized for analytics
// Dataset: analytics_ecommerce_ecommerce
//==============================================================================

TableGroup warehouse_dimensions {
  dim_customers
  dim_products
  dim_date
  dim_channels
  dim_customer_metrics
  dim_categories
  dim_social_content
}

Table dim_customers {
  customer_key integer [pk, not null, note: 'Surrogate key for customer dimension']
  customer_id integer [not null, note: 'Business key from Shopify']
  customer_email string [not null, note: 'Customer email address']
  first_name string [note: 'Customer first name']
  last_name string [note: 'Customer last name']
  full_name string [note: 'Full customer name']
  phone integer [note: 'Customer phone number']
  customer_created_at timestamp [not null, note: 'Customer creation timestamp']
  customer_updated_at timestamp [note: 'Customer last update timestamp']
  accepts_marketing string [note: 'Marketing acceptance status']
  shopify_lifetime_value numeric [note: 'Lifetime value from Shopify']
  shopify_order_count integer [note: 'Order count from Shopify']
  calculated_lifetime_value float [not null, note: 'Calculated lifetime value']
  calculated_order_count integer [not null, note: 'Calculated number of orders']
  avg_order_value float [note: 'Average order value']
  first_order_date timestamp [note: 'Date of first order']
  last_order_date timestamp [note: 'Date of last order']
  days_since_first_order integer [note: 'Days since first order']
  days_since_last_order integer [note: 'Days since last order']
  customer_segment string [note: 'RFM-based customer segment']
  customer_lifecycle_stage string [note: 'Customer lifecycle stage']
  customer_value_tier string [note: 'Value tier classification']
  recency_segment string [note: 'Recency-based segment']
  aov_segment string [note: 'Average order value segment']
  region string [note: 'Customer region']
  has_email boolean [note: 'Has email indicator']
  has_phone boolean [note: 'Has phone indicator']
  has_address boolean [note: 'Has address indicator']
  has_full_name boolean [note: 'Has full name indicator']
  effective_from timestamp [not null, note: 'SCD Type 2: Valid from timestamp']
  effective_to timestamp [note: 'SCD Type 2: Valid to timestamp']
  is_current boolean [not null, note: 'SCD Type 2: Current record indicator']
  warehouse_updated_at timestamp [note: 'Warehouse update timestamp']
  
  Note: 'SCD Type 2 customer dimension with comprehensive metrics, segmentation, and data quality indicators'
}

Table dim_products {
  product_key string [pk, not null, note: 'Surrogate key for product dimension']
  product_id bigint [not null, note: 'Business key from Shopify']
  product_title string [not null, note: 'Product title']
  product_handle string [note: 'URL handle for product']
  product_type string [note: 'Product category/type']
  vendor string [note: 'Product vendor']
  product_status string [note: 'Product status (active, draft, archived)']
  tags string [note: 'Product tags']
  price decimal [note: 'Current product price']
  cost decimal [note: 'Product cost']
  gross_margin_usd decimal [note: 'Gross margin per unit in USD']
  gross_margin_pct decimal [note: 'Gross margin percentage']
  total_revenue_usd decimal [not null, note: 'Total historical revenue in USD']
  total_orders integer [not null, note: 'Total orders containing this product']
  total_quantity_sold integer [not null, note: 'Total quantity sold']
  avg_order_value_usd decimal [note: 'Average order value for orders with this product']
  performance_tier string [note: 'Performance tier (best seller, popular, etc.)']
  revenue_tier string [note: 'Revenue tier classification']
  days_since_last_sale integer [note: 'Days since last sale']
  is_active_seller boolean [note: 'Active seller indicator']
  inventory_status string [note: 'Current inventory status']
  reorder_point integer [note: 'Reorder point threshold']
  valid_from timestamp [not null, note: 'SCD Type 2: Valid from timestamp']
  valid_to timestamp [note: 'SCD Type 2: Valid to timestamp']
  is_current boolean [not null, note: 'SCD Type 2: Current record indicator']
  
  Note: 'SCD Type 2 product dimension with performance metrics, inventory status, and profitability analysis'
}

Table dim_date {
  date_key string [pk, not null, note: 'Primary key in YYYYMMDD format']
  calendar_date date [not null, note: 'Calendar date']
  year integer [not null, note: 'Year (YYYY)']
  quarter integer [not null, note: 'Quarter (1-4)']
  month integer [not null, note: 'Month (1-12)']
  week integer [not null, note: 'Week of year (1-53)']
  day_of_year integer [not null, note: 'Day of year (1-366)']
  day_of_month integer [not null, note: 'Day of month (1-31)']
  day_of_week integer [not null, note: 'Day of week (1-7, Sunday=1)']
  day_name string [not null, note: 'Day name (Sunday, Monday, etc.)']
  month_name string [not null, note: 'Month name (January, February, etc.)']
  quarter_name string [not null, note: 'Quarter name (Q1, Q2, Q3, Q4)']
  is_weekend boolean [not null, note: 'Weekend indicator']
  is_holiday boolean [note: 'Holiday indicator']
  holiday_name string [note: 'Holiday name if applicable']
  fiscal_year integer [note: 'Fiscal year']
  fiscal_quarter integer [note: 'Fiscal quarter']
  fiscal_month integer [note: 'Fiscal month']
  is_last_day_of_month boolean [not null, note: 'Last day of month indicator']
  is_last_day_of_quarter boolean [not null, note: 'Last day of quarter indicator']
  is_last_day_of_year boolean [not null, note: 'Last day of year indicator']
  
  Note: 'Complete date dimension with calendar and fiscal attributes for time-based analysis'
}

Table dim_channels {
  channel_key integer [pk, not null, note: 'Surrogate key for channel dimension']
  channel_source_medium string [not null, note: 'Source/medium combination']
  channel_category string [not null, note: 'Channel category']
  channel_name string [not null, note: 'Channel name']
  is_paid_channel boolean [not null, note: 'Paid channel indicator']
  warehouse_updated_at timestamp [note: 'Warehouse update timestamp']
  
  Note: 'Channel dimension for marketing attribution analysis'
}

Table dim_customer_metrics {
  customer_metrics_key integer [pk, not null, note: 'Surrogate key for customer metrics dimension']
  customer_id integer [not null, note: 'Business key from Shopify']
  customer_email string [not null, note: 'Customer email address']
  customer_name string [note: 'Customer full name']
  orders_count integer [not null, note: 'Total number of orders']
  total_spent float [not null, note: 'Total amount spent']
  avg_order_value float [note: 'Average order value']
  first_order_date timestamp [note: 'First order date']
  last_order_date timestamp [note: 'Last order date']
  days_since_first_order integer [note: 'Days since first order']
  days_since_last_order integer [note: 'Days since last order']
  frequency_tier string [note: 'Order frequency tier']
  monetary_tier string [note: 'Monetary value tier']
  recency_tier string [note: 'Recency tier']
  customer_segment string [note: 'Combined RFM segment']
  customer_value_tier string [note: 'Value tier classification']
  recency_days integer [note: 'Days since last order']
  avg_days_between_orders float [note: 'Average days between orders']
  churn_probability float [note: 'Churn probability score']
  clv_predicted float [note: 'Predicted customer lifetime value']
  days_until_next_order_prediction integer [note: 'Predicted days until next order']
  warehouse_updated_at timestamp [note: 'Warehouse update timestamp']
  
  Note: 'Customer metrics dimension with RFM segmentation and predictive analytics'
}

Table dim_categories {
  category_key integer [pk, not null, note: 'Surrogate key for category dimension']
  category_name string [not null, note: 'Category name']
  parent_category string [note: 'Parent category']
  category_level integer [note: 'Category hierarchy level']
  category_path string [note: 'Full category path']
  is_active boolean [note: 'Active category indicator']
  warehouse_updated_at timestamp [note: 'Warehouse update timestamp']
  
  Note: 'Product category dimension for hierarchical analysis'
}

Table dim_social_content {
  content_key integer [pk, not null, note: 'Surrogate key for social content dimension']
  content_id string [not null, note: 'Content identifier']
  platform string [not null, note: 'Social media platform']
  content_type string [note: 'Type of content']
  content_category string [note: 'Content category']
  content_theme string [note: 'Content theme']
  has_hashtags boolean [note: 'Contains hashtags indicator']
  has_mentions boolean [note: 'Contains mentions indicator']
  has_links boolean [note: 'Contains links indicator']
  is_video boolean [note: 'Video content indicator']
  is_image boolean [note: 'Image content indicator']
  warehouse_updated_at timestamp [note: 'Warehouse update timestamp']
  
  Note: 'Social media content dimension for content performance analysis'
}

TableGroup warehouse_facts {
  fact_orders
  fact_order_items
  fact_sessions
  fact_events
  fact_customer_journey
  fact_marketing_performance
  fact_email_marketing
  fact_social_posts
  fact_inventory
  fact_ad_spend
  fact_ad_attribution
  fact_data_quality
}

Table fact_orders {
  order_key integer [pk, not null, note: 'Surrogate key for order fact']
  customer_key integer [ref: > dim_customers.customer_key, not null, note: 'Foreign key to customer dimension']
  channel_key integer [ref: > dim_channels.channel_key, not null, note: 'Foreign key to channel dimension']
  order_date_key integer [ref: > dim_date.date_key, not null, note: 'Foreign key to order date']
  processed_date_key integer [ref: > dim_date.date_key, note: 'Foreign key to processed date']
  cancelled_date_key integer [ref: > dim_date.date_key, note: 'Foreign key to cancelled date']
  order_id integer [not null, note: 'Business key from Shopify']
  order_name string [not null, note: 'Human-readable order name']
  customer_id integer [not null, note: 'Customer ID from Shopify']
  customer_email string [note: 'Customer email']
  order_created_at timestamp [not null, note: 'Order creation timestamp']
  order_updated_at timestamp [note: 'Order update timestamp']
  order_processed_at timestamp [note: 'Order processed timestamp']
  order_cancelled_at timestamp [note: 'Order cancelled timestamp']
  financial_status string [note: 'Order financial status']
  fulfillment_status string [note: 'Order fulfillment status']
  order_total_price float [not null, note: 'Total order price']
  subtotal_price float [note: 'Subtotal price']
  total_tax float [note: 'Total tax']
  total_discounts float [note: 'Total discounts']
  shipping_cost float [note: 'Shipping cost']
  order_adjustment_amount float [note: 'Order adjustment amount']
  refund_subtotal numeric [note: 'Refund subtotal']
  refund_tax integer [note: 'Refund tax']
  calculated_order_total float [note: 'Calculated order total']
  total_line_discounts float [note: 'Total line item discounts']
  total_discount_amount float [note: 'Total discount amount']
  line_item_count integer [note: 'Number of line items']
  unique_product_count integer [note: 'Number of unique products']
  total_quantity integer [note: 'Total quantity of items']
  avg_line_price float [note: 'Average line item price']
  max_line_price float [note: 'Maximum line item price']
  min_line_price float [note: 'Minimum line item price']
  discount_count integer [note: 'Number of discounts applied']
  order_value_category string [note: 'Order value category']
  source_name string [note: 'Order source']
  referring_site string [note: 'Referring website']
  landing_site_base_url string [note: 'Landing page base URL']
  channel_source_medium string [note: 'Channel source/medium']
  is_cancelled boolean [note: 'Order cancelled indicator']
  has_refund boolean [note: 'Has refund indicator']
  is_multi_product_order boolean [note: 'Multiple products indicator']
  has_discount boolean [note: 'Has discount indicator']
  discount_rate float [note: 'Discount rate percentage']
  tax_rate float [note: 'Tax rate percentage']
  shipping_rate float [note: 'Shipping rate percentage']
  net_order_value float [note: 'Net order value']
  net_subtotal float [note: 'Net subtotal']
  net_tax float [note: 'Net tax']
  hours_to_process integer [note: 'Hours to process order']
  hours_to_cancellation integer [note: 'Hours to cancellation']
  order_time_of_day string [note: 'Time of day classification']
  order_day_type string [note: 'Day type classification']
  warehouse_updated_at timestamp [note: 'Warehouse update timestamp']
  
  Note: 'Order fact table at order level with comprehensive metrics, refunds, and operational indicators'
}

Table fact_order_items {
  order_item_key string [pk, not null, note: 'Surrogate key for order item fact']
  order_key integer [ref: > fact_orders.order_key, not null, note: 'Foreign key to order fact']
  product_key integer [ref: > dim_products.product_key, not null, note: 'Foreign key to product dimension']
  customer_key integer [ref: > dim_customers.customer_key, not null, note: 'Foreign key to customer dimension']
  order_date_key integer [ref: > dim_date.date_key, not null, note: 'Foreign key to order date']
  order_id integer [not null, note: 'Order ID from Shopify']
  line_item_id bigint [not null, note: 'Line item identifier']
  product_id bigint [not null, note: 'Product ID from Shopify']
  variant_id bigint [note: 'Product variant identifier']
  sku string [note: 'Product SKU']
  quantity integer [not null, note: 'Quantity ordered']
  unit_price float [not null, note: 'Unit price']
  line_discount float [note: 'Line item discount']
  line_total float [not null, note: 'Line item total']
  tax_amount float [note: 'Tax amount for line item']
  fulfillment_status string [note: 'Line item fulfillment status']
  gift_card boolean [note: 'Gift card indicator']
  requires_shipping boolean [note: 'Requires shipping indicator']
  is_taxable boolean [note: 'Taxable item indicator']
  
  Note: 'Order items fact table at line item grain for detailed product analysis'
}

Table fact_sessions {
  session_key string [pk, not null, note: 'Surrogate key for session fact']
  session_id string [not null, note: 'Business key from GA4']
  user_pseudo_id string [not null, note: 'User pseudo ID']
  session_date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to session date']
  channel_key integer [ref: > dim_channels.channel_key, note: 'Foreign key to channel dimension']
  session_start_time timestamp [not null, note: 'Session start timestamp']
  session_end_time timestamp [note: 'Session end timestamp']
  session_duration_minutes decimal [note: 'Session duration in minutes']
  device_category string [note: 'Device category']
  browser string [note: 'Browser']
  operating_system string [note: 'Operating system']
  geo_country string [note: 'User country']
  geo_region string [note: 'User region']
  geo_city string [note: 'User city']
  page_views integer [not null, note: 'Number of page views']
  unique_pages_viewed integer [note: 'Number of unique pages viewed']
  events_count integer [note: 'Total events in session']
  scroll_events integer [note: 'Number of scroll events']
  engagement_time_seconds decimal [note: 'Total engagement time in seconds']
  has_purchase boolean [note: 'Session resulted in purchase']
  has_add_to_cart boolean [note: 'Session had add to cart events']
  has_checkout boolean [note: 'Session had checkout events']
  purchase_value_usd decimal [note: 'Purchase value in USD if applicable']
  session_type string [note: 'Session type classification']
  is_bounce boolean [note: 'Bounce session indicator']
  engagement_score decimal [note: 'Calculated engagement score']
  conversion_probability decimal [note: 'Predicted conversion probability']
  
  Note: 'Session fact table with comprehensive engagement metrics and conversion indicators'
}

Table fact_events {
  event_key string [pk, not null, note: 'Surrogate key for event fact']
  session_key string [ref: > fact_sessions.session_key, not null, note: 'Foreign key to session fact']
  event_date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to event date']
  user_pseudo_id string [not null, note: 'User pseudo ID']
  session_id string [not null, note: 'Session identifier']
  event_timestamp timestamp [not null, note: 'Event timestamp']
  event_name string [not null, note: 'Event name']
  event_category string [note: 'Event category']
  page_path string [note: 'Page path where event occurred']
  page_title string [note: 'Page title where event occurred']
  page_referrer string [note: 'Page referrer']
  scroll_depth_pct integer [note: 'Scroll depth percentage']
  time_on_page_seconds decimal [note: 'Time spent on page in seconds']
  ecommerce_value_usd decimal [note: 'Ecommerce value in USD']
  transaction_id string [note: 'Transaction ID for purchase events']
  item_count integer [note: 'Number of items for ecommerce events']
  event_value decimal [note: 'Event value']
  custom_parameter_1 string [note: 'Custom event parameter 1']
  custom_parameter_2 string [note: 'Custom event parameter 2']
  is_conversion_event boolean [note: 'Conversion event indicator']
  engagement_weight decimal [note: 'Event engagement weight']
  
  Note: 'Event fact table capturing all user interactions with detailed context and custom parameters'
}

Table fact_customer_journey {
  journey_key string [pk, not null, note: 'Surrogate key for journey fact']
  customer_key integer [ref: > dim_customers.customer_key, not null, note: 'Foreign key to customer dimension']
  order_key string [ref: > fact_orders.order_key, not null, note: 'Foreign key to order fact']
  session_key string [ref: > fact_sessions.session_key, not null, note: 'Foreign key to session fact']
  channel_key integer [ref: > dim_channels.channel_key, note: 'Foreign key to channel dimension']
  touchpoint_date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to touchpoint date']
  conversion_date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to conversion date']
  touchpoint_sequence integer [not null, note: 'Touchpoint sequence number in journey']
  days_to_conversion integer [note: 'Days from this touchpoint to conversion']
  session_duration_minutes decimal [note: 'Session duration in minutes']
  page_views integer [note: 'Page views in this session']
  engagement_score decimal [note: 'Session engagement score']
  conversion_value_usd decimal [not null, note: 'Conversion value in USD']
  attribution_weight decimal [not null, note: 'Attribution weight for this touchpoint']
  first_touch_attribution decimal [note: 'First touch attribution value']
  last_touch_attribution decimal [note: 'Last touch attribution value']
  linear_attribution decimal [note: 'Linear attribution value']
  time_decay_attribution decimal [note: 'Time decay attribution value']
  position_based_attribution decimal [note: 'Position-based attribution value']
  journey_complexity string [note: 'Journey complexity classification']
  conversion_timeline string [note: 'Conversion timeline classification']
  is_converting_session boolean [note: 'Converting session indicator']
  is_first_touch boolean [note: 'First touchpoint indicator']
  is_last_touch boolean [note: 'Last touchpoint indicator']
  
  Note: 'Customer journey fact table with multi-touch attribution and comprehensive journey analysis'
}

Table fact_marketing_performance {
  marketing_key string [pk, not null, note: 'Surrogate key for marketing fact']
  channel_key integer [ref: > dim_channels.channel_key, note: 'Foreign key to channel dimension']
  report_date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to report date']
  platform string [not null, note: 'Marketing platform (google_ads, facebook_ads, etc.)']
  campaign_id string [note: 'Campaign identifier']
  campaign_name string [note: 'Campaign name']
  ad_group_id string [note: 'Ad group identifier']
  ad_group_name string [note: 'Ad group name']
  ad_id string [note: 'Ad identifier']
  keyword string [note: 'Keyword for search campaigns']
  match_type string [note: 'Keyword match type']
  device_category string [note: 'Device category']
  geo_country string [note: 'Geographic targeting country']
  cost_usd decimal [not null, note: 'Cost in USD']
  impressions integer [not null, note: 'Number of impressions']
  clicks integer [not null, note: 'Number of clicks']
  conversions decimal [not null, note: 'Number of conversions']
  revenue decimal [note: 'Revenue attributed to marketing']
  ctr decimal [note: 'Click-through rate']
  cpc_usd decimal [note: 'Cost per click in USD']
  cpm_usd decimal [note: 'Cost per thousand impressions in USD']
  conversion_rate decimal [note: 'Conversion rate']
  cpa_usd decimal [note: 'Cost per acquisition in USD']
  roas decimal [note: 'Return on ad spend']
  quality_score decimal [note: 'Quality score (for applicable platforms)']
  performance_tier string [note: 'Performance tier classification']
  campaign_type string [note: 'Campaign type classification']
  
  Note: 'Marketing performance fact table with unified metrics across all advertising platforms'
}

Table fact_email_marketing {
  email_event_key string [pk, not null, note: 'Surrogate key for email event fact']
  campaign_id string [note: 'Campaign identifier']
  person_id string [note: 'Person identifier']
  event_date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to event date']
  event_type string [not null, note: 'Email event type']
  event_timestamp timestamp [not null, note: 'Event timestamp']
  email_address string [note: 'Email address']
  campaign_name string [note: 'Campaign name']
  campaign_subject string [note: 'Email subject line']
  campaign_type string [note: 'Campaign type']
  flow_id string [note: 'Flow identifier for automated emails']
  flow_name string [note: 'Flow name']
  is_delivered boolean [note: 'Email delivered indicator']
  is_opened boolean [note: 'Email opened indicator']
  is_clicked boolean [note: 'Email clicked indicator']
  is_bounced boolean [note: 'Email bounced indicator']
  is_marked_spam boolean [note: 'Email marked as spam indicator']
  is_unsubscribed boolean [note: 'Unsubscribed indicator']
  attributed_revenue decimal [note: 'Revenue attributed to email']
  attributed_order_id string [note: 'Order ID attributed to email']
  device_type string [note: 'Device type used to open email']
  email_client string [note: 'Email client used']
  geo_country string [note: 'Country of recipient']
  engagement_score decimal [note: 'Email engagement score']
  
  Note: 'Email marketing fact table at event grain with comprehensive engagement tracking'
}

Table fact_ad_spend {
  ad_spend_key string [pk, not null, note: 'Surrogate key for ad spend fact']
  channel_key integer [ref: > dim_channels.channel_key, note: 'Foreign key to channel dimension']
  date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to date dimension']
  platform string [not null, note: 'Advertising platform']
  account_id string [note: 'Ad account identifier']
  campaign_id string [note: 'Campaign identifier']
  campaign_name string [note: 'Campaign name']
  ad_group_id string [note: 'Ad group identifier']
  ad_group_name string [note: 'Ad group name']
  spend_usd decimal [not null, note: 'Spend amount in USD']
  impressions integer [not null, note: 'Number of impressions']
  clicks integer [not null, note: 'Number of clicks']
  conversions decimal [note: 'Number of conversions']
  conversion_value_usd decimal [note: 'Conversion value in USD']
  budget_usd decimal [note: 'Budget amount in USD']
  budget_utilization_pct decimal [note: 'Budget utilization percentage']
  
  Note: 'Ad spend fact table for daily advertising costs and performance metrics'
}

Table fact_ad_attribution {
  attribution_key string [pk, not null, note: 'Surrogate key for attribution fact']
  order_key integer [ref: > fact_orders.order_key, not null, note: 'Foreign key to order fact']
  channel_key integer [ref: > dim_channels.channel_key, not null, note: 'Foreign key to channel dimension']
  customer_key integer [ref: > dim_customers.customer_key, not null, note: 'Foreign key to customer dimension']
  attribution_date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to attribution date']
  platform string [not null, note: 'Attribution platform']
  campaign_id string [note: 'Campaign identifier']
  campaign_name string [note: 'Campaign name']
  ad_id string [note: 'Ad identifier']
  click_id string [note: 'Click identifier']
  attribution_model string [not null, note: 'Attribution model used']
  attribution_weight decimal [not null, note: 'Attribution weight (0-1)']
  attributed_revenue_usd decimal [not null, note: 'Attributed revenue in USD']
  attributed_units integer [not null, note: 'Attributed units sold']
  days_to_conversion integer [note: 'Days from click to conversion']
  is_view_through boolean [note: 'View-through conversion indicator']
  is_click_through boolean [note: 'Click-through conversion indicator']
  
  Note: 'Ad attribution fact table linking advertising touchpoints to conversions'
}

Table fact_inventory {
  inventory_key string [pk, not null, note: 'Surrogate key for inventory fact']
  product_key integer [ref: > dim_products.product_key, not null, note: 'Foreign key to product dimension']
  date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to date dimension']
  location_id string [note: 'Inventory location identifier']
  location_name string [note: 'Inventory location name']
  inventory_item_id bigint [note: 'Inventory item identifier']
  available_quantity integer [not null, note: 'Available quantity']
  committed_quantity integer [note: 'Committed quantity']
  incoming_quantity integer [note: 'Incoming quantity']
  on_hand_quantity integer [not null, note: 'On hand quantity']
  reorder_point integer [note: 'Reorder point']
  reorder_quantity integer [note: 'Reorder quantity']
  days_of_supply integer [note: 'Days of supply remaining']
  stockout_risk_score decimal [note: 'Stockout risk score (0-100)']
  inventory_value_usd decimal [note: 'Inventory value in USD']
  carrying_cost_usd decimal [note: 'Carrying cost in USD']
  
  Note: 'Inventory fact table for stock levels and inventory management metrics'
}

Table fact_social_posts {
  social_post_key string [pk, not null, note: 'Surrogate key for social post fact']
  content_key integer [ref: > dim_social_content.content_key, not null, note: 'Foreign key to content dimension']
  post_date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to post date']
  platform string [not null, note: 'Social media platform']
  post_id string [not null, note: 'Post identifier']
  account_id string [note: 'Account identifier']
  post_type string [note: 'Post type (photo, video, story, etc.)']
  post_created_at timestamp [not null, note: 'Post creation timestamp']
  impressions integer [note: 'Post impressions']
  reach integer [note: 'Post reach']
  likes integer [note: 'Number of likes']
  comments integer [note: 'Number of comments']
  shares integer [note: 'Number of shares']
  saves integer [note: 'Number of saves']
  clicks integer [note: 'Number of clicks']
  video_views integer [note: 'Video views (for video posts)']
  video_completion_rate decimal [note: 'Video completion rate']
  engagement_rate decimal [note: 'Engagement rate']
  virality_score decimal [note: 'Virality score']
  sentiment_score decimal [note: 'Sentiment analysis score']
  is_promoted boolean [note: 'Promoted post indicator']
  promotion_spend_usd decimal [note: 'Promotion spend in USD']
  attributed_conversions integer [note: 'Conversions attributed to post']
  attributed_revenue_usd decimal [note: 'Revenue attributed to post']
  
  Note: 'Social media post fact table with engagement metrics and attribution'
}

Table fact_data_quality {
  data_quality_key string [pk, not null, note: 'Surrogate key for data quality fact']
  report_date_key string [ref: > dim_date.date_key, not null, note: 'Foreign key to report date']
  data_source string [not null, note: 'Data source name']
  source_rows integer [not null, note: 'Number of rows in source']
  staging_rows integer [not null, note: 'Number of rows in staging']
  integration_rows integer [not null, note: 'Number of rows in integration']
  warehouse_rows integer [not null, note: 'Number of rows in warehouse']
  staging_flow_pct decimal [not null, note: 'Percentage flow to staging']
  integration_flow_pct decimal [not null, note: 'Percentage flow to integration']
  warehouse_flow_pct decimal [not null, note: 'Percentage flow to warehouse']
  source_test_pass_rate decimal [note: 'Source layer test pass rate']
  staging_test_pass_rate decimal [note: 'Staging layer test pass rate']
  integration_test_pass_rate decimal [note: 'Integration layer test pass rate']
  warehouse_test_pass_rate decimal [note: 'Warehouse layer test pass rate']
  overall_test_pass_rate decimal [note: 'Overall test pass rate']
  data_completeness_pct decimal [note: 'Data completeness percentage']
  data_freshness_hours decimal [note: 'Data freshness in hours']
  schema_drift_detected boolean [note: 'Schema drift detection indicator']
  duplicate_records_count integer [note: 'Number of duplicate records found']
  null_key_violations integer [note: 'Number of null key violations']
  referential_integrity_violations integer [note: 'Number of referential integrity violations']
  overall_pipeline_health_score decimal [note: 'Overall pipeline health score (0-100)']
  data_quality_rating string [note: 'Data quality rating (Excellent, Good, Poor)']
  pipeline_efficiency_rating string [note: 'Pipeline efficiency rating']
  
  Note: 'Data quality fact table for comprehensive pipeline health monitoring and data governance'
}